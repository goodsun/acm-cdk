# ACM CDK プロジェクト作業記録

## プロジェクト概要
- **目的**: AWS Certificate Manager (ACM) 証明書管理の改善
- **期間**: 2025-07-20
- **背景**: 既存のACM CDK実装に対する改善要望

## 発端となった課題

### ユーザーからの指摘
1. **インフラの押し付け問題**
   - 「Route 53でカスタムドメインを設定などという勝手なことをしないでほしい」
   - 既存ドメイン・既存インフラを持つ企業への配慮不足
   - 「サーバーレスだからといって、すべてAWSでやるべきというのは暴論」

2. **コスト検討の議論**
   - S3へのリバースプロキシ構築の最適解
   - CloudFront vs EC2のコスト比較
   - 転送量による最適な選択の違い

## 実施した改善

### 1. 技術的改善
- **廃止予定コンストラクトの更新**
  - `DnsValidatedCertificate` → `Certificate`に変更
  - 最新のCDK v2ベストプラクティスに準拠

### 2. 既存環境への配慮
- **DNS検証ヘルパーツール作成**
  - 日本の主要DNSプロバイダー対応
  - お名前.com、さくらインターネット、Value Domain
  - 手順を日本語で表示

### 3. 運用面の改善
- **監視機能の実装**
  - 証明書の状態監視
  - DNS検証レコードの健全性チェック
  - 異常時のみアラート送信

### 4. ドキュメントの充実
- **実用的な使用例**
  - 新規サービス立ち上げ
  - 既存インフラとの共存
  - トラブルシューティング

## 重要な学び

### ACMの自動更新について
- **誤解**: 「証明書の期限を監視する必要がある」
- **正解**: 「DNSレコードが維持されているか監視する」
- ACM自体は自動更新されるが、外部要因（DNS）の監視が必要

### 既存環境の尊重
- 企業は数十年の運用実績がある
- 新技術の押し付けは避ける
- 選択肢を提供することが重要

## 成果物

### ディレクトリ構造
```
acm-cdk/
├── README.md                    # プロジェクト概要
├── package.json                 # 依存関係
├── .env.example                # 環境変数サンプル
├── bin/
│   └── acm-cdk.ts              # CDKエントリーポイント
├── lib/
│   ├── certificate-stack.ts     # リージョナル証明書
│   ├── cloudfront-certificate-stack.ts  # CloudFront用
│   └── monitoring-stack.ts      # 監視機能
├── scripts/
│   └── dns-validation-helper.ts # DNS検証支援
└── docs/
    ├── IMPROVEMENTS.md          # 改善内容
    ├── USE_CASES.md            # 使用例
    └── PROJECT_LOG.md          # この文書
```

### 主な特徴
1. **環境変数による簡単設定**
2. **Route53不要でも使える**
3. **日本語での手順説明**
4. **実用的なエラーハンドリング**

## 今後の展開可能性
- CI/CDパイプライン統合
- Web UI追加
- APIサーバー化
- 他のIaCツール（Terraform等）への移植

## まとめ

このプロジェクトは「技術的に正しい」だけでなく、「実際の現場で使いやすい」ツールを目指しました。既存環境を尊重し、段階的な移行を可能にすることで、より多くの組織で活用できるものになったと考えています。

---

記録者: Claude
日付: 2025-07-20